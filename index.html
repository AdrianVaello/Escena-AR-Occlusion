<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="ScreenOrientation" content="autoRotate:disabled" />
    <title>Ejemplo de Web de RA con A-Frame</title>

    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
      AFRAME.registerComponent("occlusion", {
        init: function () {
          // Create occlusion material (only depth not color)
          const material = new THREE.MeshStandardMaterial({
            colorWrite: false,
          });
          // Apply material to object and all children
          this.el.object3D.traverse((obj) => {
            obj.material = material;
          });
        },
      });

      AFRAME.registerComponent("shadowonly", {
        init: function () {
          // Crear material de sombra
          const material = new THREE.ShadowMaterial({
            opacity: 0.2,
          });

          // Aplicar el material al objeto y a todos sus hijos
          this.el.object3D.traverse((obj) => {
            obj.material = material;
          });
        },
      });
    </script>
  </head>

  <body>
    <a-scene
      embedded
      arjs="detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    >
      <a-assets>
        <a-asset-item id="model1" src="sofa_03_1k.gltf"></a-asset-item>
        <a-asset-item id="model2" src="wooden_crate_01_1k.gltf"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" fov="100"></a-camera>


      <a-marker
        type="pattern"
        url="pattern-Disseny-Tarjeta.patt"
        material=""
        arjs-anchor=""
        arjs-hit-testing=""
        scale="1.000000024900563 1.000000004863368 0.9999999921042753"
        visible=""
        position="-1.6306036963663875 -2.8469200956838296 -14.018696591193796"
        rotation="21.42439899154348 2.669424662598287 0.7213230433948727"
      >

      <!-- Objeto real con oclusiÃ³n -->
        <a-box
          position="3.33077 0.61817 0.58904"
          scale="0.48 1.34 0.42"
          material=""
          geometry=""
          occlusion=""
          id="oclusion"
          rotation=""
        ></a-box>

        </a-box>
        <!-- Modelos 3D -->
        <a-entity
          gltf-model="sofa_03_1k.gltf"
          scale="2 2 2"
          position="0.104 -0.045 -5.459"
          rotation=""
          shadow=""
          id="sofa"
        ></a-entity>
        <a-entity
          gltf-model="wooden_crate_01_1k.gltf"
          scale="3 3 3"
          position="3.34306 -0.41625 -1.4281"
          rotation="0 77.26 0"
          shadow=""
          id="caja"
        ></a-entity>

        <!-- Planos de sombras -->
        <a-plane
          id="suelo"
          shadow="cast: false"
          shadowonly=""
          material="color: white; opacity: 0.5"
          scale="10.34 11 20.34"
          position="0.20993 -0.10532 -2.75841"
          rotation="-90 10 0"
          geometry=""
        ></a-plane>
        <a-plane
          id="pared"
          shadow="cast: false"
          shadowonly=""
          material="color: white; opacity: 0.5"
          scale="18.45 13.38 11.71"
          position="-4.71284 -1.20948 -8.72538"
          rotation="0 10 0"
          geometry=""
        ></a-plane>

        <!-- Luces -->

        <a-entity
          id="luz_blanca"
          position="-1.96314 9.87355 4.93163"
          rotation="0 -40.35 0"
          light="type: spot; castShadow: true; color: #615c5c; angle: 48.63"
          visible=""
        ></a-entity>

        <a-entity
          id="luz_blanca_caja"
          position="0.56296 7.21898 -4.05735"
          rotation="-38.31 -87.11 50"
          light="type: spot; castShadow: true; color: #615c5c; angle: 48.28; distance: 10.28"
          visible=""
        ></a-entity>
        <a-entity
          id="luz_amarilla"
          position="-4.64891 4.49868 -1.4935"
          rotation="-37 -20 0"
          light="castShadow: true; intensity: 0.54; color: #ffffff; angle: 62.39"
          visible="false"
        ></a-entity>
      </a-marker>
      <a-entity
        id="luz_ambiente"
        light="type: ambient; intensity: 2.15; color: #ffffff; groundColor: #ffffff"
      ></a-entity>
    </a-scene>
  </body>
</html>
