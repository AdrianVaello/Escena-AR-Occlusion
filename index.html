<html>
  <head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
      AFRAME.registerComponent("occlusion", {
        schema: {
          type: "boolean",
          default: true,
        },

        init: function () {
          this.setOcclusion(this.data);
        },

        update: function () {
          console.log(this.data);
          this.setOcclusion(this.data);
        },

        setOcclusion: function (val) {
          // Create occlusion material
          const material = new THREE.MeshStandardMaterial({
            colorWrite: !val,
            color: 0xff0000,
          });

          // Apply material to object and all children
          this.el.object3D.traverse((obj) => {
            obj.material = material;
          });
        },
      });

      AFRAME.registerComponent("shadowonly", {
        init: function () {
          // Crear material de sombra
          const material = new THREE.ShadowMaterial({
            opacity: 0.3,
          });

          // Aplicar el material al objeto y a todos sus hijos
          this.el.object3D.traverse((obj) => {
            obj.material = material;
          });
        },
      });
    </script>
  </head>

  <body>
    <a-scene
      embedded
      arjs="detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    >
      <a-assets>
        <a-asset-item id="model1" src="modelos/sofa_03_1k.gltf"></a-asset-item>
        <a-asset-item
          id="model2"
          src="modelos/wooden_crate_01_1k/wooden_crate_01_1k.gltf"
        ></a-asset-item>
      </a-assets>
      <a-camera position="0 0 0"></a-camera>

      <!-- Objeto real con oclusiÃ³n -->

      <a-box
        position="0.6265 0.2 -2.81636"
        scale="0.16 4.27 0.1"
        material=""
        geometry=""
        occlusion
      ></a-box>
      <a-marker type="pattern" url="pattern-Disseny-Tarjeta.patt">
        <a-box
          position="0 0.25 0"
          depth="0.5"
          height="0.5"
          width="0.5"
          material="color:red; opacity:0.5"
        >
        </a-box>
        <!-- Modelos 3D -->
        <a-entity
          gltf-model="#model1"
          scale="0.6 0.6 0.6"
          position="0.33717 0 -3.25002"
          rotation="0 -25.1 0"
          shadow=""
          id="sofa"
        ></a-entity>
        <a-entity
          gltf-model="#model2"
          scale="0.6 0.6 0.6"
          position="2.236 0 -1.71337"
          rotation="0 -40.02 0"
          shadow=""
          id="caja"
        ></a-entity>

        <!-- Planos de sombras -->
        <a-plane
          id="suelo"
          shadow="cast: false"
          shadowonly=""
          material="color: white; opacity: 0.5"
          scale="8.95 11.04 20"
          position="0.426 0 -3.561"
          rotation="-90 10 0"
          geometry=""
        ></a-plane>
        <a-plane
          id="pared"
          shadow="cast: false"
          shadowonly=""
          material="color: white; opacity: 0.5"
          scale="7.1 3.58 3"
          position="1.5569 1.5 -3.457"
          rotation="0 10 0"
          geometry=""
        ></a-plane>

        <!-- Luces -->

        <a-entity
          id="luz_blanca_caja"
          position="2.236 0.35023 -1.713"
          rotation=""
          light="type: spot; castShadow: true; color: #615c5c; angle: 48.63; target: #caja"
          visible=""
        ></a-entity>
        <a-entity
          id="luz_amarilla"
          position="-0.55184 0.10915 -0.03785"
          rotation="-37 -20 0"
          light="castShadow: true; intensity: 3.72; color: #867204; angle: 62.39"
        ></a-entity>
        <a-entity
          id="luz_ambiente"
          light="type: ambient; intensity: 2.93; color: #ffffff; groundColor: #ffffff; decay: 0; castShadow: true"
        ></a-entity>
      </a-marker>
    </a-scene>
  </body>
</html>
