<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="ScreenOrientation" content="autoRotate:disabled" />
    <title>Ejemplo de Web de RA con A-Frame</title>

    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
      AFRAME.registerComponent("occlusion", {
        init: function () {
          // Create occlusion material (only depth not color)
          const material = new THREE.MeshStandardMaterial({
            colorWrite: false,
          });
          // Apply material to object and all children
          this.el.object3D.traverse((obj) => {
            obj.material = material;
          });
        },
      });

      AFRAME.registerComponent("shadowonly", {
        init: function () {
          // Crear material de sombra
          const material = new THREE.ShadowMaterial({
            opacity: 0.3,
          });

          // Aplicar el material al objeto y a todos sus hijos
          this.el.object3D.traverse((obj) => {
            obj.material = material;
          });
        },
      });
    </script>
  </head>

  <body>
    <a-scene
      embedded
      arjs="detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    >
      <a-assets>
        <a-asset-item id="model1" src="sofa_03_1k.gltf"></a-asset-item>
        <a-asset-item id="model2" src="wooden_crate_01_1k.gltf"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" fov="100"></a-camera>

      <!-- Objeto real con oclusiÃ³n -->

      <a-box
        position="0.6265 0.2 -2.81636"
        scale="0.16 4.27 0.1"
        material=""
        geometry=""
        occlusion
      ></a-box>

      <a-marker
        type="pattern"
        url="pattern-Disseny-Tarjeta.patt"
        material=""
        arjs-anchor=""
        arjs-hit-testing=""
        position="0.363 -0.733 -3.462"
        rotation="84.58200000000001 -2.901 -5.572"
        scale=""
        visible=""
      >
        <a-box
          position="0 0.25 0"
          depth="0.5"
          height="0.5"
          width="0.5"
          material="color: red; opacity: 0.5"
          geometry=""
        >
        </a-box>
        <!-- Modelos 3D -->
        <a-entity
          gltf-model="sofa_03_1k.gltf"
          scale="0.6 0.6 0.6"
          position=""
          rotation="0 -25.1 0"
          shadow=""
          id="sofa"
        ></a-entity>
        <a-entity
          gltf-model="wooden_crate_01_1k.gltf"
          scale="0.6 0.6 0.6"
          position=""
          rotation="0 -40.02 0"
          shadow=""
          id="caja"
        ></a-entity>

        <!-- Planos de sombras -->
        <a-plane
          id="suelo"
          shadow="cast: false"
          shadowonly=""
          material="color: white; opacity: 0.5"
          scale="8.95 11.04 20"
          position=""
          rotation="-90 10 0"
          geometry=""
        ></a-plane>
        <a-plane
          id="pared"
          shadow="cast: false"
          shadowonly=""
          material="color: white; opacity: 0.5"
          scale="7.1 3.58 3"
          position=""
          rotation="0 10 0"
          geometry=""
        ></a-plane>

        <!-- Luces -->

        <a-entity
          id="luz_blanca_caja"
          position="2.236 0.35023 -1.713"
          rotation=""
          light="type: spot; castShadow: true; color: #615c5c; angle: 48.63"
          visible=""
        ></a-entity>
        <a-entity
          id="luz_amarilla"
          position="-0.55184 0.10915 -0.03785"
          rotation="-37 -20 0"
          light="castShadow: true; intensity: 3.72; color: #867204; angle: 62.39"
        ></a-entity>
      </a-marker>

      <a-entity
        id="luz_ambiente"
        light="type: ambient; intensity: 2.93; color: #ffffff; groundColor: #ffffff"
      ></a-entity>
    </a-scene>
  </body>
</html>
